# U2 — Архетипы кораблей v0.6.3

Документ заменяет версию v0.6 и фиксирует требования к ShipConfig после отказа от «гражданских» ограничителей скорости. Модель должна описывать корабль через реальные физические параметры (масса, тяга, мощность), чтобы симуляция СТО могла однозначно рассчитать скорость и ускорение без магических коэффициентов.

## 1. Ключевые различия v0.6.3

| Область | Что изменилось |
| --- | --- |
| **Performance** | Поля `scm_mps` и `vmax_mps` удалены. Добавлен блок `performance.accel_profile` с реальными ускорениями по осям (forward/backward/lateral/vertical). |
| **Propulsion** | Расширен объект `propulsion`: теперь хранит максимальную и длительную тягу главного двигателя, энергопотребление и силовой бюджет RCS. |
| **Assist** | Поле `speed_limiter_ratio` убрано. Coupled-ограничение теперь задаётся только через `cap_main_coupled`. |
| **Теги** | Каждый корабль обязан иметь набор тегов (`tags`), автоматически добываемых из size/type/назначения (см. §4). Manifest использует эти теги для фильтрации. |

## 2. Структура ShipConfig 0.6.3

```jsonc
{
  "performance": {
    "accel_profile": {
      "forward_mps2": 72,
      "backward_mps2": 32,
      "lateral_mps2": 48,
      "vertical_mps2": 36
    },
    "angular_dps": {"pitch": 95, "yaw": 80, "roll": 135},
    "angular_accel_opt": {"pitch": 210, "yaw": 180, "roll": 260}
  },
  "propulsion": {
    "main_drive": {
      "max_thrust_kN": 5200,
      "sustained_thrust_kN": 3600,
      "max_power_MW": 26
    },
    "rcs": {
      "forward_kN": 1200,
      "backward_kN": 900,
      "lateral_kN": 1500,
      "vertical_kN": 1100,
      "pitch_kNm": 420,
      "yaw_kNm": 380,
      "roll_kNm": 650
    }
  },
  "power_opt": {
    "reactor_MW": 32,
    "cooling_MW": 28
  }
}
```

### 2.1 Расчёт ускорений

- Симулятор вычисляет актуальное ускорение как `a = thrust / (mass_kg)` и уже сам ограничивает скорость так, чтобы `|v| < 0.999·c`.
- Значения `accel_profile.*` — документальные (заводские) показатели, полученные из `propulsion`. Они используются UI и тестами для контроля регрессий.

### 2.2 Обновлённый assist

```jsonc
"assist": {
  "preset": "Sport",
  "slip_lim_deg": 15,
  "stab_gain": 0.75,
  "oversteer_bias": 0.2,
  "cap_main_coupled": 0.85,
  "brake_g_sustain": 6.9,
  "brake_g_boost": 9.8,
  "boost_duration_s": 3,
  "boost_cooldown_s": 12
}
```

## 3. Рекомендации по силовой установке

| Архетип | Масса (т) | Main thrust (кН) | Sustained (кН) | Forward accel (м/с²) | Латеральная доля |
| --- | --- | --- | --- | --- | --- |
| Snub shuttle | 12–18 | 450–600 | 300 | 35–40 | 0.4 |
| Small fighter | 60–75 | 4800–5400 | 3200 | 70–85 | 0.6 |
| Medium fighter | 90–120 | 6200–7200 | 4000 | 60–70 | 0.55 |
| Medium freighter | 320–420 | 7200–9000 | 5200 | 18–24 | 0.35 |
| Heavy freighter | 650–900 | 12000–15000 | 9000 | 14–18 | 0.30 |

**Латеральная доля** — отношение `lateral_kN / forward_kN`. Чем она меньше, тем сильнее «грузовик».

## 4. Теги и manifest

Каждый `ShipConfig` должен содержать поле `tags`:

```json
"tags": ["small", "fighter", "sport", "coupled"]
```

Обязательные теги:
1. `size` (snub/small/medium/heavy/capital)
2. `type` (fighter/freighter/…)

Дополнительные теги:
- Управляемость: `sport`, `balanced`, `hauler`.
- Роль: `courier`, `recon`, `civilian`, `combat`.

Manifest (`ships/manifest.json`) сохраняет `tags`, `preview`, `forward_accel`, `power_MW` и путь к конфигу, чтобы Ship Picker мог фильтровать без чтения JSON.

## 5. Чек-лист обновления ShipConfig → 0.6.3

1. Обновить `meta.version` → `"0.6.3"`.
2. Пересчитать `propulsion.main_drive` из желаемых ускорений (`thrust_kN = accel * mass_t`).
3. Настроить `performance.accel_profile` по рассчитанным значениям (округление до целых).
4. Удалить поля `scm_mps`, `vmax_mps`, `speed_limiter_ratio`.
5. Добавить `tags`.
6. Прогнать `npm run manifest` (или вспомогательный скрипт) — файл `ships/manifest.json` должен обновиться.
7. Убедиться, что `tests/ship-adapter.test.js` проходит: адаптер обязан понимать новые поля.
