# U2 Test — Главная страница: Техническое задание

## 1. Назначение
Страница-лаунчер: выбор корабля, быстрый запуск Flight Test 2D, переходы в «Конфигуратор кораблей» и «Настройки Вселенной». Корабль по умолчанию — **small fighter**, либо последний выбранный пользователем (сохранён в localStorage).

## 2. Источники и совместимость
- **ShipConfig v0.6**: архетипы, пресеты ассиста, `classification`, `assist.preset`, `media.sprite`.
- **ShipConfig v0.5.3**: прежняя структура, `sprite.path`, поля `assist.coupled_*`.
- **AppConfig v0.5.3**: пути к конфигам, секции `world/render/hud/input/collision/autopilot`.
- **FlightTest v0.5.3**: запуск стенда, управление, режимы Coupled/Decoupled.

## 3. Отличия v0.6 vs v0.5.3 (для парсера)
- v0.6: `classification.size|type|size_type`, `assist.preset`, `media.sprite` (возможен dataURL), явный архетип.
- v0.5.3: `sprite.path`, нет именованного `assist.preset` (только параметры coupled), архетип выводится из `size`/`type`.

## 4. Пользовательские сценарии
1) Просмотр текущего корабля на главной: изображение, имя, размер/тип (архетип), тип coupled-ассиста.
2) «Выбрать корабль»: открывает модал со списком доступных конфигов и импортом файла.
3) «Поехали!»: старт Flight Test с выбранным кораблём. Генерация временного AppConfig in-memory с подставленным `paths.ship_config_path`.
4) Переходы: «Конфигуратор кораблей» (редактор ShipConfig v0.6), «Настройки Вселенной» (редактор AppConfig).

## 5. Приоритеты UI
**Блок «Корабль»:**
- Изображение 512×512, object-fit: cover, сохранение пропорций; фоллбэк-плейсхолдер при недоступности спрайта.
- Текст: `name` из конфига; архетип как `<size> <type>`; «тип coupled-ассиста» из `assist.preset` (или рекомендованный по архетипу, если поле отсутствует).

**Кнопки:**
- «Выбрать корабль» — открыть Ship Picker.
- «Поехали!» — основная CTA-кнопка (XL); стартует Flight Test.
- «Конфигуратор кораблей» — переход в редактор ShipConfig.
- «Настройки Вселенной» — переход в редактор AppConfig.

## 6. Данные, отображаемые в блоке «Корабль»
- **Название:** `meta.name` или `name`.
- **Размер/тип:** `classification.size`, `classification.type` → архетип `<size> <type>`.
- **Тип coupled-ассиста:**
  - v0.6: `assist.preset` (например, Sport/Muscle/Truck и т. п.).
  - v0.5.3: подобрать по таблице соответствия архетип→preset.
- **Подсказки (tooltip, необязательно):** масса (t), SCM/Vmax, угловые скорости, если доступны в конфиге.

## 7. Состояния и хранение
- **localStorage**
  - `u2.selectedShip.path` или `u2.selectedShip.id`
  - `u2.selectedShip.version` (0.6 или 0.5.3)
  - `u2.selectedShip.snapshot` (кэш для карточки: name, size_type, preset, preview)
- **Инициализация**
  - Если сохранённый выбор есть — загрузить его.
  - Иначе подгрузить пресет **small fighter** как дефолт.

## 8. Ship Picker — поток
- **Источники:** каталог встроенных конфигов проекта + импорт JSON пользователем.
- **Парсинг:**
  - v0.6 по схеме (`classification`, `assist.preset`, `media.sprite`).
  - v0.5.3 по старой схеме (`sprite.path`, `assist.coupled_*`).
- **Валидация:** соответствие габаритов и архетипа; мягкие предупреждения или блокировка при критических несоответствиях.
- **Превью:** карточка с именем, архетипом, пресетом ассиста и миниатюрой.
- **Выбор:** сохраняем в localStorage и закрываем модал.

## 9. «Поехали!» — запуск Flight Test
- Формируем in-memory AppConfig с `paths.ship_config_path` на выбранный конфиг и секциями по умолчанию.
- Переход на страницу симуляции или инициализация стенда в том же приложении.
- Конфиги читаются один раз при старте стенда; горячей смены корабля нет.
- Автопилот включён по умолчанию и отключается при первом вводе.

## 10. Переходы в редакторы
- **Конфигуратор кораблей:** редактор ShipConfig v0.6; миграция со старых конфигов, проверки размеров, пресетов, стелс-правил.
- **Настройки Вселенной:** редакция AppConfig (`world`, `render`, `hud`, `input`, `collision`, `asteroids`, `autopilot`, `logging`, `debug`).

## 11. Контракты данных (фронт)
**ShipSummary (UI):**
```json
{
  "id": "string",
  "name": "string",
  "size": "snub|small|medium|heavy|capital",
  "type": "fighter|freighter|…",
  "size_type": "string",
  "preset": "Sport|Muscle|Truck|…",
  "mass_t": 0,
  "scm_mps": 0,
  "vmax_mps": 0,
  "angular_dps": {"pitch":0,"yaw":0,"roll":0},
  "sprite": {"kind":"dataUrl|path","value":"string"}
}
```
**Мапперы:**
- v0.6 → ShipSummary: поля из `classification`, `assist.preset`, `media.sprite`, `mass`, `performance`.
- v0.5.3 → ShipSummary: `meta`, `geometry`, `sprite.path`, `assist.coupled_*` (preset по архетипу).

## 12. Бизнес-правила и валидации
- Архетип отображается как `<size> <type>`.
- При отсутствии `assist.preset` выводится «Рекомендованный: <preset>» по таблице соответствия архетип→preset.
- При недоступности спрайта или «tainted canvas» показывается плейсхолдер; в симуляции фоллбэк на AABB-коллизии допустим.

## 13. События UI
- «Выбрать корабль» → `openShipPicker()`
- «Поехали!» → `launchFlightTest(selectedShip)`
- «Конфигуратор кораблей» → переход `/editor/ship`
- «Настройки Вселенной» → переход `/editor/app`

## 14. Нефункциональные требования
- Инициализация превью ≤ 150 мс для 512×512.
- Адаптив 16:9…21:9; системные шрифты.
- Доступность: таб-навигация, контраст ≥ WCAG AA.
- i18n: RU/EN.

## 15. Встроенные примеры для Ship Picker
- small fighter 05 (дефолт)
- medium fighter 1
- medium freighter 2

## 16. Критерии приёмки
- Первый запуск: показан small fighter 05 с корректным архетипом и типом ассиста по пресету.
- После выбора другого корабля карточка обновляется, выбор сохраняется, «Поехали!» запускает Flight Test с этим ship.json.
- В симуляции работают предписанные клавиши и автопилот по умолчанию.

