# U2 — Архетипы кораблей v0.6

  

# U2 Архетипы кораблей — унификация размеров и пресетов

 

## Канонический формат

 

**Шаблон:** <size> <type>

 

**Размеры:** snub, small, medium, heavy, capital
 **Типы:** fighter, interceptor, gunship, bomber, dropship, courier, freighter, exploration, passenger, miner, tanker, salvager, repair, recon, corvette, frigate, destroyer, carrier, dreadnought

 

## Пресеты

 

Balanced, Sport, Rally, Muscle, F1, Industrial, Truck, Warship, Liner, Recon

 

## Правила стелса

 

- recon — всегда stealth.
- bomber и dropship могут быть standard или stealth.
- Остальные типы — только standard, если не указано иначе.

 

---

 

## Канонические архетипы (единый стиль)

 

| Размер | Тип | Пример имени |
|----|----|----|
| snub | shuttle | snub shuttle |
| small | fighter | small fighter |
| medium | fighter | medium fighter |
| heavy | fighter | heavy fighter |
| small | interceptor | small interceptor |
| medium | gunship | medium gunship |
| medium | bomber | medium bomber / medium stealth bomber |
| medium | dropship | medium dropship / medium stealth dropship |
| small | courier | small courier |
| small | freighter | small freighter |
| medium | freighter | medium freighter |
| heavy | freighter | heavy freighter |
| capital | freighter | capital freighter |
| small | exploration | small exploration |
| medium | exploration | medium exploration |
| heavy | exploration | heavy exploration |
| small | passenger | small passenger |
| medium | passenger | medium passenger |
| large | passenger | large passenger |
| small | miner | small miner |
| medium | miner | medium miner |
| heavy | miner | heavy miner |
| capital | miner | capital miner |
| small | tanker | small tanker |
| medium | tanker | medium tanker |
| heavy | tanker | heavy tanker |
| capital | tanker | capital tanker |
| small | salvager | small salvager |
| medium | salvager | medium salvager |
| heavy | salvager | heavy salvager |
| capital | salvager | capital salvager |
| small | repair | small repair |
| medium | repair | medium repair |
| heavy | repair | heavy repair |
| small | recon | small stealth recon |
| medium | recon | medium stealth recon |
| capital | corvette | capital corvette |
| capital | frigate | capital frigate |
| capital | destroyer | capital destroyer |
| capital | carrier | capital carrier |
| capital | dreadnought | capital dreadnought |

 

---

 

## Соответствие архетипов и пресетов

 

| Архетип (size type) | Стелс | Пресет |
|----|----|----|
| snub shuttle | standard | Balanced |
| small fighter | standard | Sport |
| medium fighter | standard | Muscle |
| heavy fighter | standard | Muscle |
| small interceptor | standard | Rally |
| medium gunship | standard | Warship |
| medium bomber | standard | Warship |
| medium bomber | stealth | Warship (stealth mode) |
| medium dropship | standard | Truck |
| medium dropship | stealth | Truck (stealth mode) |
| small courier | standard | F1 |
| small freighter | standard | Truck |
| medium freighter | standard | Truck |
| heavy freighter | standard | Truck |
| capital freighter | standard | Truck |
| small exploration | standard | Balanced |
| medium exploration | standard | Balanced |
| heavy exploration | standard | Balanced |
| small passenger | standard | Liner |
| medium passenger | standard | Liner |
| large passenger | standard | Liner |
| small miner | standard | Industrial |
| medium miner | standard | Industrial |
| heavy miner | standard | Industrial |
| capital miner | standard | Industrial |
| small tanker | standard | Truck |
| medium tanker | standard | Truck |
| heavy tanker | standard | Truck |
| capital tanker | standard | Truck |
| small salvager | standard | Industrial |
| medium salvager | standard | Industrial |
| heavy salvager | standard | Industrial |
| capital salvager | standard | Industrial |
| small repair | standard | Industrial |
| medium repair | standard | Industrial |
| heavy repair | standard | Industrial |
| small stealth recon | stealth | Recon |
| medium stealth recon | stealth | Recon |
| capital corvette | standard | Warship |
| capital frigate | standard | Warship |
| capital destroyer | standard | Warship |
| capital carrier | standard | Warship |
| capital dreadnought | standard | Warship |

 

---

 

## Таблица параметров (пример)

 

| Размер | Архетип (size type) | Стелс | Д×Ш×В, м | Масса, т | Экипаж | Груз | SCM, м/с | Vmax, м/с | a_fwd, м/с² | Стрейфы X/Y/Z, м/с² | Pitch/Yaw/Roll, °/с | Оружие | IR/EM/CS |
|----|----|----|----|----|----|----|----|----|----|----|----|----|----|
| medium | medium repair | standard | 40×28×12 | 150 | 2–4 | 40–80 / 40–80 | 160 | 900 | 32 | 48/48/48 | 55/45/85 | 1–2×S2, drones | 3/3/3 |
| small | small stealth recon | stealth | 26×17×6 | 65 | 1–2 | 8–20 / 10–20 | 250 | 1200 | 60 | 65/65/65 | 90/75/110 | light | 1/1/1 |
| medium | medium stealth bomber | stealth | 70×35×14 | 200 | 2–6 | 0–8 / 0 | 140 | 900 | 35 | 35/35/35 | 30/25/60 | torpedoes S7–S9 | 2/2/2 |
| medium | medium stealth dropship | stealth | 38×28×10 | 160 | 2–4 | 8–20 / 10–20 | 180 | 950 | 40 | 45/45/45 | 45/40/80 | 1–2 turrets S3–S4 | 2/2/2 |

 

---

 

## Интеграция в редактор ТТХ

 

- Поля: size, type, size_type (генерируется автоматически), stealth, preset.
- Пользователь **обязан указать** size и type. size_type создаётся автоматически.
- Пресет предлагается системой, но его можно изменять вручную. При изменении отображаются отличия от рекомендованного.
- Для bomber и dropship переключатель stealth активирует коэффициенты режима stealth_mode.
- Для recon всегда stealth=true и preset=Recon.
- Пример экспорта: { size: "medium", type: "miner", size_type: "medium miner", stealth: "standard", preset: "Industrial" }.

 

### Валидация размеров по габаритам и массе

 

Редактор проверяет, соответствуют ли длина и масса корабля выбранному размеру.

 

| Размер | Длина, м | Масса, т |
|----|----|----|
| snub | < 12 | < 20 |
| small | 12–25 | 20–80 |
| medium | 25–60 | 80–250 |
| heavy | 60–120 | 250–900 |
| capital | > 120 | > 900 |

 

**Проверка:**

 

- Мягкое предупреждение — отклонение ±15% от нормы.
- Жёсткая ошибка — более 30% отклонения.
- Предложение автоматически изменить size на ближайший подходящий.

 

**Пример псевдокода**

 

```javascript
function validate_size(hull):
  env = envelope[hull.size]
  ratio_len = out_of_band_ratio(hull.length, env.Lmin, env.Lmax)
  ratio_mass = out_of_band_ratio(hull.mass, env.Mmin, env.Mmax)
  max_ratio = max(ratio_len, ratio_mass)
  if max_ratio <= 0.15: return OK
  if max_ratio <= 0.30: return WARNING with suggestion(next_size_tier(hull))
  return ERROR with block and suggestion(next_size_tier(hull))
```

 

### Интерфейс редактора

 

- В верхней панели — баннер: «Рекомендованный пресет: . Можно изменить.»
- Отображение различий от рекомендованного.
- Подсказки при редактировании геометрии: «Габариты выходят за пределы диапазона для выбранного размера. Измените размер или параметры корпуса.»
- Возможность автоопределения размера по габаритам при импорте модели с подтверждением пользователя.

 

---

 

# Ship Editor v0.6 — файлы для внедрения

 

Ниже прикреплены готовые заготовки для репозитория dkomlev/ship-editor:

 

- config/shipconfig.schema.json — JSON Schema v0.6
- js/schema.js — перечисления, фабрика пустого конфига
- js/presets.js — пресеты ассистентов и маппинг архетипов
- js/validator.js — проверки размеров и ограничители ассиста
- js/migrate.js — миграция старых конфигов в v0.6
- editor.html — обновлённый каркас редактора
- configs/small_stealth_recon.json и configs/medium_miner.json — примеры ShipConfig v0.6

 

## config/shipconfig.schema.json

 

```javascript
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://u2.example/schema/shipconfig-v0.6.json",
  "title": "U2 ShipConfig v0.6",
  "type": "object",
  "required": [
    "meta","classification","geometry","mass","signatures",
    "performance","propulsion","payload","weapons","assist"
  ],
  "properties": {
    "meta": {
      "type": "object",
      "required": ["id","name","version"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "name": { "type": "string", "minLength": 1 },
        "version": { "type": "string", "pattern": "^[0-9]+.[0-9]+.[0-9]+$" }
      }
    },
    "classification": {
      "type": "object",
      "required": ["size","type","size_type","stealth"],
      "properties": {
        "size": { "enum": ["snub","small","medium","heavy","capital"] },
        "type": { "enum": [
          "shuttle","fighter","interceptor","gunship","bomber","dropship","courier",
          "freighter","exploration","passenger","miner","tanker","salvager","repair",
          "recon","corvette","frigate","destroyer","carrier","dreadnought"
        ] },
        "size_type": {
          "type": "string",
          "pattern": "^(snub|small|medium|heavy|capital)\s+(shuttle|fighter|interceptor|gunship|bomber|dropship|courier|freighter|exploration|passenger|miner|tanker|salvager|repair|recon|corvette|frigate|destroyer|carrier|dreadnought)$"
        },
        "stealth": { "enum": ["standard","stealth"] },
        "variant": { "type": ["string","null"] }
      }
    },
    "geometry": {
      "type": "object",
      "required": ["length_m","width_m","height_m"],
      "properties": {
        "length_m": { "type": "number", "minimum": 0 },
        "width_m":  { "type": "number", "minimum": 0 },
        "height_m": { "type": "number", "minimum": 0 }
      }
    },
    "mass": {
      "type": "object",
      "required": ["dry_t"],
      "properties": {
        "dry_t": { "type": "number", "minimum": 0 }
      }
    },
    "inertia_opt": {
      "type": "object",
      "properties": {
        "Ixx": { "type": ["number","null"], "minimum": 0 },
        "Iyy": { "type": ["number","null"], "minimum": 0 },
        "Izz": { "type": ["number","null"], "minimum": 0 }
      },
      "additionalProperties": false
    },
    "signatures": {
      "type": "object",
      "required": ["IR","EM","CS"],
      "properties": {
        "IR": { "type": "integer", "minimum": 1, "maximum": 5 },
        "EM": { "type": "integer", "minimum": 1, "maximum": 5 },
        "CS": { "type": "integer", "minimum": 1, "maximum": 5 }
      }
    },
    "performance": {
      "type": "object",
      "required": ["scm_mps","vmax_mps","accel_fwd_mps2","strafe_mps2","angular_dps"],
      "properties": {
        "scm_mps": { "type": "number", "minimum": 0 },
        "vmax_mps": { "type": "number", "minimum": 0 },
        "accel_fwd_mps2": { "type": "number", "minimum": 0 },
        "strafe_mps2": {
          "type": "object",
          "required": ["x","y","z"],
          "properties": {
            "x": { "type": "number", "minimum": 0 },
            "y": { "type": "number", "minimum": 0 },
            "z": { "type": "number", "minimum": 0 }
          }
        },
        "angular_dps": {
          "type": "object",
          "required": ["pitch","yaw","roll"],
          "properties": {
            "pitch": { "type": "number", "minimum": 0 },
            "yaw":   { "type": "number", "minimum": 0 },
            "roll":  { "type": "number", "minimum": 0 }
          }
        },
        "angular_accel_opt": {
          "type": "object",
          "properties": {
            "pitch": { "type": ["number","null"], "minimum": 0 },
            "yaw":   { "type": ["number","null"], "minimum": 0 },
            "roll":  { "type": ["number","null"], "minimum": 0 }
          },
          "additionalProperties": false
        }
      }
    },
    "propulsion": {
      "type": "object",
      "required": ["main_thrust_MN","rcs_budget_MN"],
      "properties": {
        "main_thrust_MN": { "type": "number", "minimum": 0 },
        "rcs_budget_MN":  { "type": "number", "minimum": 0 }
      }
    },
    "power_opt": {
      "type": "object",
      "properties": {
        "reactor_MW": { "type": ["number","null"], "minimum": 0 },
        "cooling_MW": { "type": ["number","null"], "minimum": 0 }
      },
      "additionalProperties": false
    },
    "payload": {
      "type": "object",
      "required": ["cargo_scu","crew"],
      "properties": {
        "cargo_scu": { "type": "number", "minimum": 0 },
        "crew": { "type": "string" }
      }
    },
    "hardpoints_opt": {
      "type": "object",
      "properties": {
        "fixed": { "type": "array", "items": { "type": "string" } },
        "gimbals": { "type": "array", "items": { "type": "string" } },
        "turrets": { "type": "array", "items": { "type": "string" } },
        "missiles": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "weapons": {
      "type": "object",
      "required": ["summary"],
      "properties": { "summary": { "type": "string" } }
    },
    "assist": {
      "type": "object",
      "required": [
        "preset","slip_lim_deg","stab_gain","oversteer_bias",
        "cap_main_coupled","speed_limiter_ratio",
        "brake_g_sustain","brake_g_boost",
        "boost_duration_s","boost_cooldown_s"
      ],
      "properties": {
        "preset": { "enum": ["Balanced","Sport","Rally","Muscle","F1","Industrial","Truck","Warship","Liner","Recon"] },
        "slip_lim_deg": { "type": "number", "minimum": 0, "maximum": 45 },
        "stab_gain": { "type": "number", "minimum": 0, "maximum": 1 },
        "oversteer_bias": { "type": "number", "minimum": -1, "maximum": 1 },
        "cap_main_coupled": { "type": "number", "minimum": 0, "maximum": 1 },
        "speed_limiter_ratio": { "type": "number", "minimum": 0, "maximum": 1 },
        "brake_g_sustain": { "type": "number", "minimum": 0 },
        "brake_g_boost": { "type": "number", "minimum": 0 },
        "boost_duration_s": { "type": "number", "minimum": 0 },
        "boost_cooldown_s": { "type": "number", "minimum": 0 }
      }
    },
    "notes_opt": { "type": "string" }
  },
  "additionalProperties": false
}
```

 

## js/schema.js

 

```javascript
export const SIZE = ["snub","small","medium","heavy","capital"];
export const TYPE = [
  "shuttle","fighter","interceptor","gunship","bomber","dropship","courier",
  "freighter","exploration","passenger","miner","tanker","salvager","repair",
  "recon","corvette","frigate","destroyer","carrier","dreadnought"
];
export const STEALTH = ["standard","stealth"];
export const PRESET = ["Balanced","Sport","Rally","Muscle","F1","Industrial","Truck","Warship","Liner","Recon"];

export const sizeType = (size, type) => `${size} ${type}`;

export function buildEmptyConfig({ id = crypto.randomUUID(), name = "New Ship", version = "0.6.0" } = {}) {
  return {
    meta: { id, name, version },
    classification: { size: "small", type: "fighter", size_type: "small fighter", stealth: "standard", variant: null },
    geometry: { length_m: 20, width_m: 14, height_m: 5 },
    mass: { dry_t: 60 },
    inertia_opt: { Ixx: null, Iyy: null, Izz: null },
    signatures: { IR: 3, EM: 3, CS: 3 },
    performance: {
      scm_mps: 200, vmax_mps: 1100, accel_fwd_mps2: 60,
      strafe_mps2: { x: 60, y: 60, z: 60 },
      angular_dps: { pitch: 80, yaw: 70, roll: 110 },
      angular_accel_opt: { pitch: null, yaw: null, roll: null }
    },
    propulsion: { main_thrust_MN: (60*60)/1e6, rcs_budget_MN: 1.0 },
    power_opt: { reactor_MW: null, cooling_MW: null },
    payload: { cargo_scu: 0, crew: "1" },
    hardpoints_opt: { fixed: [], gimbals: [], turrets: [], missiles: [] },
    weapons: { summary: "" },
    assist: {
      preset: "Sport", slip_lim_deg: 15, stab_gain: 0.75, oversteer_bias: 0.2,
      cap_main_coupled: 0.85, speed_limiter_ratio: 0.8,
      brake_g_sustain: 7.0, brake_g_boost: 10.0,
      boost_duration_s: 3.0, boost_cooldown_s: 12
    },
    notes_opt: ""
  };
}
```

 

## js/presets.js

 

```javascript
export const ASSIST = {
  Balanced:  { slip_lim_deg:12, stab_gain:0.90, oversteer_bias:0.00, cap_main_coupled:0.75, speed_limiter_ratio:0.75, brake_g_sustain:4.5, brake_g_boost:6.5,  boost_duration_s:3.5, boost_cooldown_s:15 },
  Sport:     { slip_lim_deg:15, stab_gain:0.75, oversteer_bias:0.20, cap_main_coupled:0.85, speed_limiter_ratio:0.80, brake_g_sustain:7.0, brake_g_boost:10.0, boost_duration_s:3.0, boost_cooldown_s:12 },
  Rally:     { slip_lim_deg:18, stab_gain:0.70, oversteer_bias:0.30, cap_main_coupled:0.90, speed_limiter_ratio:0.85, brake_g_sustain:7.5, brake_g_boost:10.0, boost_duration_s:3.0, boost_cooldown_s:12 },
  Muscle:    { slip_lim_deg:10, stab_gain:0.80, oversteer_bias:0.00, cap_main_coupled:0.75, speed_limiter_ratio:0.75, brake_g_sustain:5.5, brake_g_boost:8.0,  boost_duration_s:3.0, boost_cooldown_s:14 },
  F1:        { slip_lim_deg:8,  stab_gain:0.95, oversteer_bias:0.00, cap_main_coupled:0.80, speed_limiter_ratio:0.85, brake_g_sustain:6.5, brake_g_boost:9.0,  boost_duration_s:3.0, boost_cooldown_s:12 },
  Industrial:{ slip_lim_deg:10, stab_gain:0.96, oversteer_bias:-0.15,cap_main_coupled:0.60, speed_limiter_ratio:0.60, brake_g_sustain:4.0, brake_g_boost:6.0,  boost_duration_s:3.5, boost_cooldown_s:18 },
  Truck:     { slip_lim_deg:8,  stab_gain:0.95, oversteer_bias:-0.30,cap_main_coupled:0.55, speed_limiter_ratio:0.60, brake_g_sustain:2.5, brake_g_boost:3.5,  boost_duration_s:5.0, boost_cooldown_s:25 },
  Warship:   { slip_lim_deg:7,  stab_gain:0.95, oversteer_bias:-0.10,cap_main_coupled:0.60, speed_limiter_ratio:0.60, brake_g_sustain:2.0, brake_g_boost:3.5,  boost_duration_s:6.0, boost_cooldown_s:35 },
  Liner:     { slip_lim_deg:8,  stab_gain:0.95, oversteer_bias:-0.25,cap_main_coupled:0.55, speed_limiter_ratio:0.60, brake_g_sustain:2.5, brake_g_boost:3.5,  boost_duration_s:5.0, boost_cooldown_s:22 },
  Recon:     { slip_lim_deg:6,  stab_gain:0.98, oversteer_bias:0.00, cap_main_coupled:0.40, speed_limiter_ratio:0.65, brake_g_sustain:3.5, brake_g_boost:5.0,  boost_duration_s:3.0, boost_cooldown_s:12 }
};

export const ARCH_PRESET = [
  { size:"snub",    type:"shuttle",     preset:"Balanced" },
  { size:"small",   type:"fighter",     preset:"Sport" },
  { size:"medium",  type:"fighter",     preset:"Muscle" },
  { size:"heavy",   type:"fighter",     preset:"Muscle" },
  { size:"small",   type:"interceptor", preset:"Rally" },
  { size:"medium",  type:"gunship",     preset:"Warship" },
  { size:"medium",  type:"bomber",      preset:"Warship" },
  { size:"medium",  type:"dropship",    preset:"Truck" },
  { size:"small",   type:"courier",     preset:"F1" },
  { size:"small",   type:"freighter",   preset:"Truck" },
  { size:"medium",  type:"freighter",   preset:"Truck" },
  { size:"heavy",   type:"freighter",   preset:"Truck" },
  { size:"capital", type:"freighter",   preset:"Truck" },
  { size:"small",   type:"exploration", preset:"Balanced" },
  { size:"medium",  type:"exploration", preset:"Balanced" },
  { size:"heavy",   type:"exploration", preset:"Balanced" },
  { size:"small",   type:"passenger",   preset:"Liner" },
  { size:"medium",  type:"passenger",   preset:"Liner" },
  { size:"heavy",   type:"passenger",   preset:"Liner" },
  { size:"small",   type:"miner",       preset:"Industrial" },
  { size:"medium",  type:"miner",       preset:"Industrial" },
  { size:"heavy",   type:"miner",       preset:"Industrial" },
  { size:"capital", type:"miner",       preset:"Industrial" },
  { size:"small",   type:"tanker",      preset:"Truck" },
  { size:"medium",  type:"tanker",      preset:"Truck" },
  { size:"heavy",   type:"tanker",      preset:"Truck" },
  { size:"capital", type:"tanker",      preset:"Truck" },
  { size:"small",   type:"salvager",    preset:"Industrial" },
  { size:"medium",  type:"salvager",    preset:"Industrial" },
  { size:"heavy",   type:"salvager",    preset:"Industrial" },
  { size:"capital", type:"salvager",    preset:"Industrial" },
  { size:"small",   type:"repair",      preset:"Industrial" },
  { size:"medium",  type:"repair",      preset:"Industrial" },
  { size:"heavy",   type:"repair",      preset:"Industrial" },
  { size:"small",   type:"recon",       preset:"Recon" },
  { size:"medium",  type:"recon",       preset:"Recon" },
  { size:"capital", type:"corvette",    preset:"Warship" },
  { size:"capital", type:"frigate",     preset:"Warship" },
  { size:"capital", type:"destroyer",   preset:"Warship" },
  { size:"capital", type:"carrier",     preset:"Warship" },
  { size:"capital", type:"dreadnought", preset:"Warship" }
];

export function applyStealthMode(assist, type) {
  const a = { ...assist };
  if (type === "recon") return a; // already optimized
  a.cap_main_coupled *= 0.8;
  a.speed_limiter_ratio *= 0.9;
  return a;
}
```

 

## js/validator.js

 

```javascript
export const ENVELOPE = {
  snub:    { Lmin: 0,  Lmax: 12,  Mmin: 0,  Mmax: 20  },
  small:   { Lmin: 12, Lmax: 25,  Mmin: 20, Mmax: 80  },
  medium:  { Lmin: 25, Lmax: 60,  Mmin: 80, Mmax: 250 },
  heavy:   { Lmin: 60, Lmax: 120, Mmin: 250,Mmax: 900 },
  capital: { Lmin: 120,Lmax: 1e9, Mmin: 900,Mmax: 1e9 }
};

const ratioOB = (x, min, max) => {
  if (x < min) return (min - x) / (min || 1);
  if (x > max) return (x - max) / (max || 1);
  return 0;
};

export function validateSize(hull) {
  const env = ENVELOPE[hull.classification.size];
  const rL = ratioOB(hull.geometry.length_m, env.Lmin, env.Lmax);
  const rM = ratioOB(hull.mass.dry_t,        env.Mmin, env.Mmax);
  const maxR = Math.max(rL, rM);
  if (maxR <= 0.15) return { level:"ok",   maxR };
  if (maxR <= 0.30) return { level:"warn", maxR, suggestion: suggestSize(hull) };
  return                 { level:"error",maxR, suggestion: suggestSize(hull) };
}

export function suggestSize(hull) {
  const L = hull.geometry.length_m;
  const M = hull.mass.dry_t;
  const tiers = Object.entries(ENVELOPE);
  let best = "small", bestScore = 1e9;
  for (const [k, e] of tiers) {
    const rL = ratioOB(L, e.Lmin, e.Lmax);
    const rM = ratioOB(M, e.Mmin, e.Mmax);
    const score = Math.max(rL, rM);
    if (score < bestScore) { bestScore = score; best = k; }
  }
  return best;
}

export function clampAssistToPhysics(assist, perf) {
  const g = 9.80665;
  const maxG = (perf.accel_fwd_mps2 || 0) / g;
  const out = { ...assist };
  if (Number.isFinite(maxG)) {
    out.brake_g_sustain = Math.min(out.brake_g_sustain, 0.85 * maxG);
    out.brake_g_boost   = Math.min(out.brake_g_boost,   1.20 * maxG);
  }
  return out;
}
```

 

## js/migrate.js

 

```javascript
import { SIZE, TYPE, sizeType } from './schema.js';
import { ASSIST, ARCH_PRESET, applyStealthMode } from './presets.js';
import { clampAssistToPhysics } from './validator.js';

const mapType = (s) => {
  const t = String(s || '').toLowerCase();
  const dict = new Map([
    ["fighter","fighter"], ["lf","fighter"], ["hf","fighter"],
    ["int","interceptor"], ["interceptor","interceptor"],
    ["gunship","gunship"], ["bomber","bomber"], ["torpedo","bomber"],
    ["dropship","dropship"], ["courier","courier"],
    ["freighter","freighter"], ["cargo","freighter"],
    ["exploration","exploration"], ["passenger","passenger"],
    ["miner","miner"], ["tanker","tanker"], ["salvage","salvager"], ["salvager","salvager"],
    ["repair","repair"],
    ["recon","recon"], ["stealth","recon"],
    ["shuttle","shuttle"],
    ["corvette","corvette"],["frigate","frigate"],["destroyer","destroyer"],["carrier","carrier"],["dreadnought","dreadnought"]
  ]);
  return dict.get(t) || 'fighter';
};

const inferSize = (L, M) => {
  if (L >= 120 || M >= 900) return 'capital';
  if (L >= 60  || M >= 250) return 'heavy';
  if (L >= 25  || M >= 80 ) return 'medium';
  if (L >= 12  || M >= 20 ) return 'small';
  return 'snub';
};

const pickPreset = (size, type) => (ARCH_PRESET.find(x => x.size===size && x.type===type)?.preset) || 'Balanced';

export function migrateToV06(old) {
  const size = inferSize(old.length_m ?? old.geometry?.length_m, old.mass_t ?? old.mass?.dry_t);
  const type = mapType(old.role || old.type || old.classification?.type);
  const stealth = type === 'recon' ? 'stealth' : (old.stealth ? 'stealth' : 'standard');

  const perf = {
    scm_mps: old.SCM ?? old.scm ?? old.performance?.scm_mps ?? 0,
    vmax_mps: old.Vmax ?? old.vmax ?? old.performance?.vmax_mps ?? 0,
    accel_fwd_mps2: old.a_fwd ?? old.performance?.accel_fwd_mps2 ?? 0,
    strafe_mps2: {
      x: old.ax ?? old.performance?.strafe_mps2?.x ?? 0,
      y: old.ay ?? old.performance?.strafe_mps2?.y ?? 0,
      z: old.az ?? old.performance?.strafe_mps2?.z ?? 0
    },
    angular_dps: {
      pitch: old.pitch ?? old.performance?.angular_dps?.pitch ?? 0,
      yaw:   old.yaw   ?? old.performance?.angular_dps?.yaw   ?? 0,
      roll:  old.roll  ?? old.performance?.angular_dps?.roll  ?? 0
    },
    angular_accel_opt: { pitch: null, yaw: null, roll: null }
  };

  let assist = ASSIST[pickPreset(size, type)];
  if (stealth === 'stealth' && type !== 'recon') assist = applyStealthMode(assist, type);
  assist = clampAssistToPhysics(assist, perf);

  return {
    meta: { id: old.id || crypto.randomUUID(), name: old.name || 'Unnamed', version: '0.6.0' },
    classification: { size, type, size_type: sizeType(size,type), stealth, variant: old.variant ?? null },
    geometry: { length_m: old.length_m ?? old.geometry?.length_m ?? 0, width_m: old.width_m ?? old.geometry?.width_m ?? 0, height_m: old.height_m ?? old.geometry?.height_m ?? 0 },
    mass: { dry_t: old.mass_t ?? old.mass?.dry_t ?? 0 },
    inertia_opt: old.inertia_opt ?? { Ixx:null, Iyy:null, Izz:null },
    signatures: { IR: old.IR ?? old.signatures?.IR ?? 3, EM: old.EM ?? old.signatures?.EM ?? 3, CS: old.CS ?? old.signatures?.CS ?? 3 },
    performance: perf,
    propulsion: {
      main_thrust_MN: old.thrust_main ?? old.propulsion?.main_thrust_MN ?? (((old.mass_t ?? 0) * (old.a_fwd ?? 0)) / 1e6),
      rcs_budget_MN:  old.rcs_MN ?? old.propulsion?.rcs_budget_MN ?? 0
    },
    power_opt: { reactor_MW: old.reactor_MW ?? null, cooling_MW: old.cooling_MW ?? null },
    payload: { cargo_scu: old.cargo_scu ?? old.payload?.cargo_scu ?? 0, crew: String(old.crew ?? old.payload?.crew ?? '1') },
    hardpoints_opt: {
      fixed: old.fixed ?? old.hardpoints_opt?.fixed ?? [],
      gimbals: old.gimbals ?? old.hardpoints_opt?.gimbals ?? [],
      turrets: old.turrets ?? old.hardpoints_opt?.turrets ?? [],
      missiles: old.missiles ?? old.hardpoints_opt?.missiles ?? []
    },
    weapons: { summary: old.weapons_summary ?? old.weapons?.summary ?? '' },
    assist,
    notes_opt: old.notes ?? null
  };
}
```

 

## editor.html (каркас)

 

```javascript
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>U2 Ship Editor v0.6</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:16px}
    fieldset{margin:12px 0;padding:12px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .col{display:flex;flex-direction:column;gap:6px}
    .badge{padding:2px 8px;border-radius:12px;background:#eee}
    .warn{color:#b36b00}.err{color:#a30000}
    table{border-collapse:collapse}
    td,th{border:1px solid #ddd;padding:6px 8px}
    pre{background:#111;color:#eee;padding:8px;overflow:auto}
  </style>
</head>
<body>
  <h1>U2 Ship Editor <small class="badge">ShipConfig v0.6</small></h1>

  <fieldset>
    <legend>Классификация</legend>
    <div class="row">
      <label>size
        <select id="size"></select>
      </label>
      <label>type
        <select id="type"></select>
      </label>
      <label>size_type
        <input id="size_type" type="text" readonly>
      </label>
      <label>stealth
        <select id="stealth">
          <option value="standard">standard</option>
          <option value="stealth">stealth</option>
        </select>
      </label>
      <span id="presetBanner" class="badge">Suggested preset: <b id="suggestedPreset"></b></span>
    </div>
  </fieldset>

  <fieldset>
    <legend>Геометрия и масса</legend>
    <div class="row">
      <label>L <input id="length" type="number" step="0.1"></label>
      <label>W <input id="width"  type="number" step="0.1"></label>
      <label>H <input id="height" type="number" step="0.1"></label>
      <label>Mass (t) <input id="mass" type="number" step="0.1"></label>
      <span id="sizeCheck" class="badge">size envelope: <b id="sizeState">ok</b></span>
      <button id="autoSize">Автоподбор size</button>
    </div>
  </fieldset>

  <fieldset>
    <legend>Signatures</legend>
    <div class="row">
      <label>IR <input id="ir" type="number" min="1" max="5"></label>
      <label>EM <input id="em" type="number" min="1" max="5"></label>
      <label>CS <input id="cs" type="number" min="1" max="5"></label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Performance</legend>
    <div class="row">
      <label>SCM <input id="scm" type="number" step="1"></label>
      <label>Vmax <input id="vmax" type="number" step="1"></label>
      <label>a_fwd <input id="a_fwd" type="number" step="0.1"></label>
      <label>Strafe X <input id="sx" type="number" step="0.1"></label>
      <label>Y <input id="sy" type="number" step="0.1"></label>
      <label>Z <input id="sz" type="number" step="0.1"></label>
      <label>Pitch <input id="pitch" type="number" step="0.1"></label>
      <label>Yaw <input id="yaw" type="number" step="0.1"></label>
      <label>Roll <input id="roll" type="number" step="0.1"></label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Propulsion</legend>
    <div class="row">
      <label>Main thrust (MN) <input id="thrust" type="number" step="0.01"></label>
      <label>RCS budget (MN) <input id="rcs" type="number" step="0.01"></label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Payload / Weapons</legend>
    <div class="row">
      <label>Cargo (SCU) <input id="cargo" type="number" step="1"></label>
      <label>Crew <input id="crew" type="text"></label>
      <label>Weapons summary <input id="wep" type="text"></label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Assist</legend>
    <div class="row">
      <label>Preset <select id="preset"></select></label>
      <button id="applyPreset">Применить пресет</button>
      <button id="resetPreset">Сбросить к пресету</button>
    </div>
    <div class="row">
      <label>slip_lim_deg <input id="slip" type="number" step="0.1"></label>
      <label>stab_gain <input id="stab" type="number" step="0.01" min="0" max="1"></label>
      <label>oversteer_bias <input id="bias" type="number" step="0.01" min="-1" max="1"></label>
      <label>cap_main_coupled <input id="cap" type="number" step="0.01" min="0" max="1"></label>
      <label>speed_limiter_ratio <input id="lim" type="number" step="0.01" min="0" max="1"></label>
      <label>brake_g_sustain <input id="g1" type="number" step="0.1"></label>
      <label>brake_g_boost <input id="g2" type="number" step="0.1"></label>
      <label>boost_duration_s <input id="bd" type="number" step="0.1"></label>
      <label>boost_cooldown_s <input id="bc" type="number" step="0.1"></label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Import / Export</legend>
    <div class="row">
      <input type="file" id="file" accept="application/json">
      <button id="importBtn">Импорт</button>
      <button id="exportBtn">Экспорт</button>
    </div>
    <pre id="out"></pre>
  </fieldset>

  <script type="module">
    import { SIZE, TYPE, STEALTH, PRESET, sizeType, buildEmptyConfig } from './js/schema.js';
    import { ASSIST, ARCH_PRESET, applyStealthMode } from './js/presets.js';
    import { validateSize, suggestSize, clampAssistToPhysics } from './js/validator.js';

    const el = id => document.getElementById(id);
    const ui = {
      size: el('size'), type: el('type'), size_type: el('size_type'), stealth: el('stealth'),
      length: el('length'), width: el('width'), height: el('height'), mass: el('mass'),
      ir: el('ir'), em: el('em'), cs: el('cs'), scm: el('scm'), vmax: el('vmax'), a_fwd: el('a_fwd'),
      sx: el('sx'), sy: el('sy'), sz: el('sz'), pitch: el('pitch'), yaw: el('yaw'), roll: el('roll'),
      thrust: el('thrust'), rcs: el('rcs'), cargo: el('cargo'), crew: el('crew'), wep: el('wep'),
      preset: el('preset'), slip: el('slip'), stab: el('stab'), bias: el('bias'), cap: el('cap'), lim: el('lim'),
      g1: el('g1'), g2: el('g2'), bd: el('bd'), bc: el('bc'),
      out: el('out'), presetBanner: el('suggestedPreset'), sizeState: el('sizeState')
    };

    // Populate selects
    SIZE.forEach(s=>ui.size.add(new Option(s,s)));
    TYPE.forEach(t=>ui.type.add(new Option(t,t)));
    PRESET.forEach(p=>ui.preset.add(new Option(p,p)));

    let ship = buildEmptyConfig();
    bindFromModel();
    updatePresetBanner();
    validateEnvelope();

    function updateClass() {
      ship.classification.size = ui.size.value;
      ship.classification.type = ui.type.value;
      if (ship.classification.type === 'recon') ui.stealth.value = 'stealth';
      ship.classification.stealth = ui.stealth.value;
      ship.classification.size_type = sizeType(ship.classification.size, ship.classification.type);
      ui.size_type.value = ship.classification.size_type;
      updatePresetBanner();
    }

    function updatePresetBanner() {
      const m = ARCH_PRESET.find(x=>x.size===ship.classification.size && x.type===ship.classification.type);
      const suggested = m?.preset || 'Balanced';
      ui.preset.value = ship.assist.preset || suggested;
      ui.presetBanner.textContent = suggested;
    }

    function bindFromModel(){
      ui.size.value = ship.classification.size;
      ui.type.value = ship.classification.type;
      ui.stealth.value = ship.classification.stealth;
      ui.size_type.value = ship.classification.size_type;
      ui.length.value = ship.geometry.length_m;
      ui.width.value  = ship.geometry.width_m;
      ui.height.value = ship.geometry.height_m;
      ui.mass.value   = ship.mass.dry_t;
      ui.ir.value = ship.signatures.IR; ui.em.value = ship.signatures.EM; ui.cs.value = ship.signatures.CS;
      ui.scm.value = ship.performance.scm_mps; ui.vmax.value = ship.performance.vmax_mps; ui.a_fwd.value = ship.performance.accel_fwd_mps2;
      ui.sx.value = ship.performance.strafe_mps2.x; ui.sy.value = ship.performance.strafe_mps2.y; ui.sz.value = ship.performance.strafe_mps2.z;
      ui.pitch.value = ship.performance.angular_dps.pitch; ui.yaw.value = ship.performance.angular_dps.yaw; ui.roll.value = ship.performance.angular_dps.roll;
      ui.thrust.value = ship.propulsion.main_thrust_MN; ui.rcs.value = ship.propulsion.rcs_budget_MN;
      ui.cargo.value = ship.payload.cargo_scu; ui.crew.value = ship.payload.crew; ui.wep.value = ship.weapons.summary;
      setAssistFields(ship.assist);
    }
    function setAssistFields(a){ ui.slip.value=a.slip_lim_deg; ui.stab.value=a.stab_gain; ui.bias.value=a.oversteer_bias; ui.cap.value=a.cap_main_coupled; ui.lim.value=a.speed_limiter_ratio; ui.g1.value=a.brake_g_sustain; ui.g2.value=a.brake_g_boost; ui.bd.value=a.boost_duration_s; ui.bc.value=a.boost_cooldown_s; }
    function readAssist(){ return { preset: ui.preset.value, slip_lim_deg:+ui.slip.value, stab_gain:+ui.stab.value, oversteer_bias:+ui.bias.value, cap_main_coupled:+ui.cap.value, speed_limiter_ratio:+ui.lim.value, brake_g_sustain:+ui.g1.value, brake_g_boost:+ui.g2.value, boost_duration_s:+ui.bd.value, boost_cooldown_s:+ui.bc.value } }

    // Events
    ui.size.onchange = ui.type.onchange = ui.stealth.onchange = ()=>{ updateClass(); render(); };
    [ui.length,ui.width,ui.height,ui.mass].forEach(x=>x.oninput=()=>{ writeGeom(); validateEnvelope(); render(); });
    [ui.ir,ui.em,ui.cs,ui.scm,ui.vmax,ui.a_fwd,ui.sx,ui.sy,ui.sz,ui.pitch,ui.yaw,ui.roll,ui.thrust,ui.rcs,ui.cargo,ui.crew,ui.wep].forEach(x=>x.oninput=()=>{ writeMisc(); render(); });
    ui.preset.onchange = ()=>{ applyPreset(); render(); };
    document.getElementById('applyPreset').onclick = ()=>{ applyPreset(); render(); };
    document.getElementById('resetPreset').onclick = ()=>{ resetToPreset(); render(); };
    document.getElementById('autoSize').onclick = ()=>{ autoPickSize(); render(); };

    function writeGeom(){ ship.geometry.length_m=+ui.length.value; ship.geometry.width_m=+ui.width.value; ship.geometry.height_m=+ui.height.value; ship.mass.dry_t=+ui.mass.value; }
    function writeMisc(){ ship.signatures.IR=+ui.ir.value; ship.signatures.EM=+ui.em.value; ship.signatures.CS=+ui.cs.value; ship.performance.scm_mps=+ui.scm.value; ship.performance.vmax_mps=+ui.vmax.value; ship.performance.accel_fwd_mps2=+ui.a_fwd.value; ship.performance.strafe_mps2={x:+ui.sx.value,y:+ui.sy.value,z:+ui.sz.value}; ship.performance.angular_dps={pitch:+ui.pitch.value,yaw:+ui.yaw.value,roll:+ui.roll.value}; ship.propulsion.main_thrust_MN=+ui.thrust.value; ship.propulsion.rcs_budget_MN=+ui.rcs.value; ship.payload.cargo_scu=+ui.cargo.value; ship.payload.crew=ui.crew.value; ship.weapons.summary=ui.wep.value; ship.assist = readAssist(); ship.assist = clampAssistToPhysics(ship.assist, ship.performance); }

    function applyPreset(){
      const rec = ARCH_PRESET.find(x=>x.size===ship.classification.size && x.type===ship.classification.type)?.preset || 'Balanced';
      let a = { ...ASSIST[ui.preset.value || rec] };
      if (ship.classification.stealth==='stealth' && ship.classification.type!=='recon') a = applyStealthMode(a, ship.classification.type);
      ship.assist = clampAssistToPhysics(a, ship.performance);
      ship.assist.preset = ui.preset.value || rec;
      setAssistFields(ship.assist);
    }
    function resetToPreset(){ ui.preset.value = ARCH_PRESET.find(x=>x.size===ship.classification.size && x.type===ship.classification.type)?.preset || 'Balanced'; applyPreset(); }

    function validateEnvelope(){
      const v = validateSize(ship);
      ui.sizeState.textContent = v.level;
      ui.sizeState.className = v.level==='ok'? '' : (v.level==='warn'? 'warn':'err');
    }
    function autoPickSize(){ ship.classification.size = suggestSize(ship); ui.size.value = ship.classification.size; updateClass(); validateEnvelope(); }

    function render(){
      const exportObj = JSON.parse(JSON.stringify(ship));
      exportObj.classification.size_type = sizeType(ship.classification.size, ship.classification.type);
      exportObj.meta.version = '0.6.0';
      ui.out.textContent = JSON.stringify(exportObj, null, 2);
    }

    // Import / Export
    document.getElementById('importBtn').onclick = async ()=>{
      const f = document.getElementById('file').files[0]; if(!f) return;
      const txt = await f.text();
      try { ship = JSON.parse(txt); } catch(e){ alert('Invalid JSON'); return; }
      // naive migration path
      if (!ship.meta || !ship.classification) {
        const { migrateToV06 } = await import('./js/migrate.js');
        ship = migrateToV06(ship);
      }
      bindFromModel(); updateClass(); validateEnvelope(); render();
    };
    document.getElementById('exportBtn').onclick = ()=>{
      const blob = new Blob([ui.out.textContent], {type:'application/json'});
      const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(blob), download:`shipconfig-v0.6.json`});
      a.click(); URL.revokeObjectURL(a.href);
    };

    render();
  </script>
</body>
</html>
```

 

## configs/small_stealth_recon.json (ShipConfig v0.6)

 

```javascript
{
  "meta": { "id": "u2_small_stealth_recon_001", "name": "Small Stealth Recon", "version": "0.6.0" },
  "classification": { "size": "small", "type": "recon", "size_type": "small recon", "stealth": "stealth", "variant": null },
  "geometry": { "length_m": 26, "width_m": 17, "height_m": 6 },
  "mass": { "dry_t": 65 },
  "inertia_opt": { "Ixx": null, "Iyy": null, "Izz": null },
  "signatures": { "IR": 1, "EM": 1, "CS": 1 },
  "performance": {
    "scm_mps": 250, "vmax_mps": 1200, "accel_fwd_mps2": 60,
    "strafe_mps2": { "x": 65, "y": 65, "z": 65 },
    "angular_dps": { "pitch": 90, "yaw": 75, "roll": 110 },
    "angular_accel_opt": { "pitch": null, "yaw": null, "roll": null }
  },
  "propulsion": { "main_thrust_MN": 3.9, "rcs_budget_MN": 1.2 },
  "power_opt": { "reactor_MW": null, "cooling_MW": null },
  "payload": { "cargo_scu": 8, "crew": "1-2" },
  "hardpoints_opt": { "fixed": [], "gimbals": [], "turrets": [], "missiles": [] },
  "weapons": { "summary": "light recon fit" },
  "assist": {
    "preset": "Recon",
    "slip_lim_deg": 6, "stab_gain": 0.98, "oversteer_bias": 0.0,
    "cap_main_coupled": 0.40, "speed_limiter_ratio": 0.65,
    "brake_g_sustain": 3.5, "brake_g_boost": 5.0,
    "boost_duration_s": 3.0, "boost_cooldown_s": 12
  },
  "notes_opt": "Cold approach, bearing bias enabled by default."
}
```

 

## configs/medium_miner.json (ShipConfig v0.6)

 

```javascript
{
  "meta": { "id": "u2_medium_miner_001", "name": "Medium Miner Mk.I", "version": "0.6.0" },
  "classification": { "size": "medium", "type": "miner", "size_type": "medium miner", "stealth": "standard", "variant": null },
  "geometry": { "length_m": 38, "width_m": 30, "height_m": 12 },
  "mass": { "dry_t": 160 },
  "inertia_opt": { "Ixx": null, "Iyy": null, "Izz": null },
  "signatures": { "IR": 3, "EM": 3, "CS": 3 },
  "performance": {
    "scm_mps": 160, "vmax_mps": 900, "accel_fwd_mps2": 35,
    "strafe_mps2": { "x": 40, "y": 40, "z": 40 },
    "angular_dps": { "pitch": 45, "yaw": 40, "roll": 75 },
    "angular_accel_opt": { "pitch": null, "yaw": null, "roll": null }
  },
  "propulsion": { "main_thrust_MN": 5.6, "rcs_budget_MN": 1.8 },
  "power_opt": { "reactor_MW": null, "cooling_MW": null },
  "payload": { "cargo_scu": 96, "crew": "2-3" },
  "hardpoints_opt": { "fixed": [], "gimbals": [], "turrets": [], "missiles": [] },
  "weapons": { "summary": "3×mining S2; 2×defense S2" },
  "assist": {
    "preset": "Industrial",
    "slip_lim_deg": 10, "stab_gain": 0.92, "oversteer_bias": -0.15,
    "cap_main_coupled": 0.65, "speed_limiter_ratio": 0.65,
    "brake_g_sustain": 3.5, "brake_g_boost": 5.5,
    "boost_duration_s": 4.0, "boost_cooldown_s": 18.0
  },
  "notes_opt": "Micro-positioning recommended near targets."
}
```

 

---

 

> Готово для прямого копирования в репозиторий. При необходимости разделю по файлам PR-шаблоном и добавлю README для разработчиков.

 

---

 

## Библиотека типовых ТТХ (SC/ED) → автоподстановка в редакторе

 

Добавлен модуль js/nominals.js и кнопка «Применить архетип» в editor.html. Номиналы используются как рекомендуемые значения при выборе size и type (учёт stealth и пресета). Значения подобраны по усреднённым данным из SC/ED и приведены к нашим размерам и единицам.

 

### js/nominals.js

 

```javascript
// Typicals derived from SC/ED averages, adjusted to U2 envelopes (SI units)
// main_thrust_MN ~= mass_t * accel_fwd_mps2 / 1000

const RCS_RATIO = { small:0.30, medium:0.30, heavy:0.20, capital:0.20, snub:0.30 };
const tier = s => (s==='snub'||s==='small')?'small':(s==='medium'?'medium':(s==='heavy'?'heavy':'capital'));

export const NOMINALS = {
  // Flight/utility
  'snub shuttle': {
    size:'snub', type:'shuttle', preset:'Balanced', stealth:'standard',
    geometry:{length_m:9, width_m:7, height_m:3}, mass:{dry_t:8},
    signatures:{IR:2,EM:2,CS:2},
    performance:{scm_mps:180, vmax_mps:800, accel_fwd_mps2:50,
      strafe_mps2:{x:45,y:45,z:45}, angular_dps:{pitch:80,yaw:80,roll:120}},
    payload:{cargo_scu:0, crew:'1'}, weapons:{summary:'2×S1'},
  },
  // Fighters
  'small fighter': {
    size:'small', type:'fighter', preset:'Sport', stealth:'standard',
    geometry:{length_m:18, width_m:13, height_m:4}, mass:{dry_t:55},
    signatures:{IR:2,EM:2,CS:2},
    performance:{scm_mps:230, vmax_mps:1200, accel_fwd_mps2:80,
      strafe_mps2:{x:80,y:80,z:80}, angular_dps:{pitch:90,yaw:75,roll:120}},
    payload:{cargo_scu:0, crew:'1'}, weapons:{summary:'2–3×S3 + missiles'}
  },
  'medium fighter': {
    size:'medium', type:'fighter', preset:'Muscle', stealth:'standard',
    geometry:{length_m:24, width_m:16, height_m:5}, mass:{dry_t:80},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:250, vmax_mps:1230, accel_fwd_mps2:70,
      strafe_mps2:{x:70,y:70,z:70}, angular_dps:{pitch:105,yaw:95,roll:140}},
    payload:{cargo_scu:0, crew:'1'}, weapons:{summary:'3–4×S3/4, missiles'}
  },
  'heavy fighter': {
    size:'heavy', type:'fighter', preset:'Muscle', stealth:'standard',
    geometry:{length_m:38, width_m:25, height_m:8}, mass:{dry_t:110},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:210, vmax_mps:1075, accel_fwd_mps2:50,
      strafe_mps2:{x:55,y:55,z:55}, angular_dps:{pitch:44,yaw:38,roll:124}},
    payload:{cargo_scu:0, crew:'1–2'}, weapons:{summary:'nose S5 + turrets'}
  },
  'small interceptor': {
    size:'small', type:'interceptor', preset:'Rally', stealth:'standard',
    geometry:{length_m:20, width_m:14, height_m:4}, mass:{dry_t:45},
    signatures:{IR:2,EM:2,CS:2},
    performance:{scm_mps:260, vmax_mps:1400, accel_fwd_mps2:90,
      strafe_mps2:{x:85,y:85,z:85}, angular_dps:{pitch:95,yaw:80,roll:130}},
    payload:{cargo_scu:0, crew:'1'}, weapons:{summary:'2×S3 + 6×S1–S2 missiles'}
  },
  // Gunship/Bomber/Dropship
  'medium gunship': {
    size:'medium', type:'gunship', preset:'Warship', stealth:'standard',
    geometry:{length_m:45, width_m:30, height_m:10}, mass:{dry_t:180},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:190, vmax_mps:950, accel_fwd_mps2:40,
      strafe_mps2:{x:45,y:45,z:45}, angular_dps:{pitch:40,yaw:35,roll:75}},
    payload:{cargo_scu:8, crew:'2–4'}, weapons:{summary:'1–2×S4–S5 turrets, missiles'}
  },
  'medium bomber': {
    size:'medium', type:'bomber', preset:'Warship', stealth:'standard',
    geometry:{length_m:70, width_m:35, height_m:14}, mass:{dry_t:200},
    signatures:{IR:3,EM:2,CS:3},
    performance:{scm_mps:140, vmax_mps:900, accel_fwd_mps2:35,
      strafe_mps2:{x:35,y:35,z:35}, angular_dps:{pitch:30,yaw:25,roll:60}},
    payload:{cargo_scu:8, crew:'2–6'}, weapons:{summary:'torpedoes S7–S9 + turrets'}
  },
  'medium stealth bomber': {
    inherit:'medium bomber', stealth:'stealth', adjust:{ signatures:{IR:-1,EM:-1,CS:-1} }
  },
  'medium dropship': {
    size:'medium', type:'dropship', preset:'Truck', stealth:'standard',
    geometry:{length_m:38, width_m:28, height_m:10}, mass:{dry_t:160},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:180, vmax_mps:950, accel_fwd_mps2:40,
      strafe_mps2:{x:45,y:45,z:45}, angular_dps:{pitch:45,yaw:40,roll:80}},
    payload:{cargo_scu:20, crew:'2–4'}, weapons:{summary:'1–2×S3–S4 turrets'}
  },
  'medium stealth dropship': {
    inherit:'medium dropship', stealth:'stealth', adjust:{ signatures:{IR:-1,EM:-1,CS:-1} }
  },
  // Courier
  'small courier': {
    size:'small', type:'courier', preset:'F1', stealth:'standard',
    geometry:{length_m:24, width_m:16, height_m:6}, mass:{dry_t:70},
    signatures:{IR:2,EM:2,CS:2},
    performance:{scm_mps:260, vmax_mps:1200, accel_fwd_mps2:70,
      strafe_mps2:{x:70,y:70,z:70}, angular_dps:{pitch:85,yaw:70,roll:110}},
    payload:{cargo_scu:16, crew:'1–2'}, weapons:{summary:'light defensive'}
  },
  // Freighters
  'small freighter': {
    size:'small', type:'freighter', preset:'Truck', stealth:'standard',
    geometry:{length_m:24, width_m:16, height_m:8}, mass:{dry_t:80},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:200, vmax_mps:1000, accel_fwd_mps2:35,
      strafe_mps2:{x:35,y:35,z:35}, angular_dps:{pitch:40,yaw:35,roll:75}},
    payload:{cargo_scu:60, crew:'2–3'}, weapons:{summary:'2×S2–S3 defense'}
  },
  'medium freighter': {
    size:'medium', type:'freighter', preset:'Truck', stealth:'standard',
    geometry:{length_m:50, width_m:32, height_m:14}, mass:{dry_t:200},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:190, vmax_mps:950, accel_fwd_mps2:30,
      strafe_mps2:{x:30,y:30,z:30}, angular_dps:{pitch:35,yaw:30,roll:65}},
    payload:{cargo_scu:120, crew:'3–4'}, weapons:{summary:'2–3 turrets S2–S3'}
  },
  'heavy freighter': {
    size:'heavy', type:'freighter', preset:'Truck', stealth:'standard',
    geometry:{length_m:110, width_m:50, height_m:20}, mass:{dry_t:450},
    signatures:{IR:4,EM:4,CS:4},
    performance:{scm_mps:170, vmax_mps:900, accel_fwd_mps2:25,
      strafe_mps2:{x:25,y:25,z:25}, angular_dps:{pitch:25,yaw:16,roll:25}},
    payload:{cargo_scu:500, crew:'4–6'}, weapons:{summary:'4–6 turrets'}
  },
  'capital freighter': {
    size:'capital', type:'freighter', preset:'Truck', stealth:'standard',
    geometry:{length_m:180, width_m:60, height_m:30}, mass:{dry_t:1200},
    signatures:{IR:4,EM:4,CS:5},
    performance:{scm_mps:120, vmax_mps:800, accel_fwd_mps2:15,
      strafe_mps2:{x:15,y:15,z:15}, angular_dps:{pitch:20,yaw:12,roll:20}},
    payload:{cargo_scu:2000, crew:'6–12'}, weapons:{summary:'defense batteries'}
  },
  // Exploration
  'small exploration': {
    size:'small', type:'exploration', preset:'Balanced', stealth:'standard',
    geometry:{length_m:24, width_m:16, height_m:6}, mass:{dry_t:70},
    signatures:{IR:2,EM:2,CS:2},
    performance:{scm_mps:250, vmax_mps:1200, accel_fwd_mps2:65,
      strafe_mps2:{x:65,y:65,z:65}, angular_dps:{pitch:85,yaw:70,roll:110}},
    payload:{cargo_scu:16, crew:'1–2'}, weapons:{summary:'light, sensors'}
  },
  'medium exploration': {
    size:'medium', type:'exploration', preset:'Balanced', stealth:'standard',
    geometry:{length_m:55, width_m:32, height_m:14}, mass:{dry_t:180},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:220, vmax_mps:1050, accel_fwd_mps2:45,
      strafe_mps2:{x:50,y:50,z:50}, angular_dps:{pitch:70,yaw:55,roll:95}},
    payload:{cargo_scu:100, crew:'2–4'}, weapons:{summary:'1–2 turrets, drones'}
  },
  'heavy exploration': {
    size:'heavy', type:'exploration', preset:'Balanced', stealth:'standard',
    geometry:{length_m:110, width_m:50, height_m:28}, mass:{dry_t:480},
    signatures:{IR:3,EM:3,CS:3},
    performance:{scm_mps:165, vmax_mps:900, accel_fwd_mps2:28,
      strafe_mps2:{x:30,y:30,z:30}, angular_dps:{pitch:30,yaw:16,roll:30}},
    payload:{cargo_scu:456, crew:'4–6'}, weapons:{summary:'3–5 turrets, medbay'}
  },
  // Passenger
  'small passenger': { size:'small', type:'passenger', preset:'Liner', stealth:'standard',
    geometry:{length_m:24,width_m:16,height_m:10}, mass:{dry_t:150}, signatures:{IR:3,EM:3,CS:4},
    performance:{scm_mps:130,vmax_mps:900,accel_fwd_mps2:20, strafe_mps2:{x:20,y:20,z:20}, angular_dps:{pitch:20,yaw:15,roll:25}},
    payload:{cargo_scu:50, crew:'6–10'}, weapons:{summary:'defense'} },
  'medium passenger': { size:'medium', type:'passenger', preset:'Liner', stealth:'standard',
    geometry:{length_m:60,width_m:25,height_m:15}, mass:{dry_t:300}, signatures:{IR:3,EM:3,CS:4},
    performance:{scm_mps:120,vmax_mps:915,accel_fwd_mps2:18, strafe_mps2:{x:18,y:18,z:18}, angular_dps:{pitch:18,yaw:12,roll:20}},
    payload:{cargo_scu:120, crew:'8–20'}, weapons:{summary:'defense'} },
  'heavy passenger': { size:'heavy', type:'passenger', preset:'Liner', stealth:'standard',
    geometry:{length_m:110,width_m:35,height_m:20}, mass:{dry_t:900}, signatures:{IR:3,EM:3,CS:4},
    performance:{scm_mps:110,vmax_mps:915,accel_fwd_mps2:15, strafe_mps2:{x:15,y:15,z:15}, angular_dps:{pitch:10,yaw:10,roll:15}},
    payload:{cargo_scu:200, crew:'12–30'}, weapons:{summary:'defense batteries'} },
  // Industrial
  'small miner':   { size:'small',  type:'miner',   preset:'Industrial', stealth:'standard', geometry:{length_m:24,width_m:18,height_m:7}, mass:{dry_t:60},  signatures:{IR:3,EM:3,CS:3}, performance:{scm_mps:170,vmax_mps:900,accel_fwd_mps2:40, strafe_mps2:{x:45,y:45,z:45}, angular_dps:{pitch:55,yaw:45,roll:85}}, payload:{cargo_scu:32, crew:'1'},   weapons:{summary:'mining S1'} },
  'medium miner':  { size:'medium', type:'miner',  preset:'Industrial', stealth:'standard', geometry:{length_m:38,width_m:30,height_m:12},mass:{dry_t:160}, signatures:{IR:3,EM:3,CS:3}, performance:{scm_mps:160,vmax_mps:900,accel_fwd_mps2:35, strafe_mps2:{x:40,y:40,z:40}, angular_dps:{pitch:45,yaw:40,roll:75}}, payload:{cargo_scu:96, crew:'2–3'}, weapons:{summary:'3×mining S2'} },
  'heavy miner':   { size:'heavy',  type:'miner',   preset:'Industrial', stealth:'standard', geometry:{length_m:100,width_m:50,height_m:30},mass:{dry_t:600}, signatures:{IR:4,EM:4,CS:4}, performance:{scm_mps:130,vmax_mps:800,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:20,yaw:12,roll:20}}, payload:{cargo_scu:600, crew:'6–12'}, weapons:{summary:'industrial RIO'} },
  'capital miner': { size:'capital',type:'miner',  preset:'Industrial', stealth:'standard', geometry:{length_m:180,width_m:70,height_m:40},mass:{dry_t:1200},signatures:{IR:4,EM:4,CS:4}, performance:{scm_mps:120,vmax_mps:800,accel_fwd_mps2:20, strafe_mps2:{x:20,y:20,z:20}, angular_dps:{pitch:20,yaw:12,roll:20}}, payload:{cargo_scu:1200,crew:'12–24'}, weapons:{summary:'industrial RIO'} },
  'small tanker':  { size:'small', type:'tanker',  preset:'Truck', stealth:'standard', geometry:{length_m:24,width_m:14,height_m:9}, mass:{dry_t:120},signatures:{IR:4,EM:5,CS:4}, performance:{scm_mps:160,vmax_mps:850,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:25,yaw:18,roll:30}}, payload:{cargo_scu:200,crew:'4–6'}, weapons:{summary:'defense'} },
  'medium tanker': { size:'medium',type:'tanker', preset:'Truck', stealth:'standard', geometry:{length_m:60,width_m:30,height_m:15}, mass:{dry_t:400},signatures:{IR:4,EM:5,CS:4}, performance:{scm_mps:150,vmax_mps:850,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:25,yaw:18,roll:30}}, payload:{cargo_scu:400,crew:'6–10'}, weapons:{summary:'defense'} },
  'heavy tanker':  { size:'heavy', type:'tanker',  preset:'Truck', stealth:'standard', geometry:{length_m:110,width_m:50,height_m:25},mass:{dry_t:800}, signatures:{IR:4,EM:5,CS:4}, performance:{scm_mps:150,vmax_mps:850,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:25,yaw:18,roll:30}}, payload:{cargo_scu:800,crew:'8–14'}, weapons:{summary:'defense'} },
  'capital tanker':{ size:'capital',type:'tanker', preset:'Truck', stealth:'standard', geometry:{length_m:180,width_m:70,height_m:30},mass:{dry_t:1200},signatures:{IR:4,EM:5,CS:4}, performance:{scm_mps:150,vmax_mps:850,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:25,yaw:18,roll:30}}, payload:{cargo_scu:1600,crew:'12–20'}, weapons:{summary:'defense'} },
  'small salvager': { size:'small', type:'salvager', preset:'Industrial', stealth:'standard', geometry:{length_m:24,width_m:16,height_m:9}, mass:{dry_t:120},signatures:{IR:3,EM:3,CS:3}, performance:{scm_mps:150,vmax_mps:800,accel_fwd_mps2:24, strafe_mps2:{x:24,y:24,z:24}, angular_dps:{pitch:28,yaw:20,roll:30}}, payload:{cargo_scu:60, crew:'3–4'}, weapons:{summary:'beams + defense'} },
  'medium salvager':{ size:'medium',type:'salvager',preset:'Industrial', stealth:'standard', geometry:{length_m:60,width_m:30,height_m:15}, mass:{dry_t:300},signatures:{IR:4,EM:4,CS:4}, performance:{scm_mps:140,vmax_mps:800,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:24,yaw:18,roll:28}}, payload:{cargo_scu:200,crew:'4–8'}, weapons:{summary:'beams + defense'} },
  'heavy salvager': { size:'heavy', type:'salvager', preset:'Industrial', stealth:'standard', geometry:{length_m:100,width_m:60,height_m:30},mass:{dry_t:600}, signatures:{IR:4,EM:4,CS:4}, performance:{scm_mps:130,vmax_mps:800,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:22,yaw:15,roll:28}}, payload:{cargo_scu:400,crew:'6–12'}, weapons:{summary:'beams + defense'} },
  'capital salvager':{ size:'capital',type:'salvager',preset:'Industrial', stealth:'standard', geometry:{length_m:155,width_m:120,height_m:45},mass:{dry_t:1000},signatures:{IR:4,EM:4,CS:4}, performance:{scm_mps:130,vmax_mps:800,accel_fwd_mps2:22, strafe_mps2:{x:22,y:22,z:22}, angular_dps:{pitch:22,yaw:15,roll:28}}, payload:{cargo_scu:400,crew:'6–12'}, weapons:{summary:'beams + defense'} },
  // Repair
  'small repair':  { size:'small',  type:'repair',  preset:'Industrial', stealth:'standard', geometry:{length_m:24,width_m:16,height_m:9}, mass:{dry_t:100},signatures:{IR:3,EM:3,CS:3}, performance:{scm_mps:160,vmax_mps:900,accel_fwd_mps2:30, strafe_mps2:{x:40,y:40,z:40}, angular_dps:{pitch:55,yaw:45,roll:85}}, payload:{cargo_scu:40, crew:'2–3'}, weapons:{summary:'drones + defense'} },
  'medium repair': { size:'medium', type:'repair', preset:'Industrial', stealth:'standard', geometry:{length_m:40,width_m:28,height_m:12},mass:{dry_t:150},signatures:{IR:3,EM:3,CS:3}, performance:{scm_mps:160,vmax_mps:900,accel_fwd_mps2:32, strafe_mps2:{x:48,y:48,z:48}, angular_dps:{pitch:55,yaw:45,roll:85}}, payload:{cargo_scu:80, crew:'2–4'}, weapons:{summary:'drones + defense'} },
  'heavy repair':  { size:'heavy',  type:'repair',  preset:'Industrial', stealth:'standard', geometry:{length_m:90,width_m:40,height_m:18},mass:{dry_t:500},signatures:{IR:4,EM:4,CS:4}, performance:{scm_mps:150,vmax_mps:850,accel_fwd_mps2:24, strafe_mps2:{x:30,y:30,z:30}, angular_dps:{pitch:35,yaw:25,roll:40}}, payload:{cargo_scu:150,crew:'4–8'}, weapons:{summary:'drones + defense'} },
  // Recon (always stealth)
  'small recon': {
    size:'small', type:'recon', preset:'Recon', stealth:'stealth',
    geometry:{length_m:26, width_m:17, height_m:6}, mass:{dry_t:65},
    signatures:{IR:1,EM:1,CS:1},
    performance:{scm_mps:250, vmax_mps:1200, accel_fwd_mps2:60,
      strafe_mps2:{x:65,y:65,z:65}, angular_dps:{pitch:90,yaw:75,roll:110}},
    payload:{cargo_scu:8, crew:'1–2'}, weapons:{summary:'light recon fit'}
  },
  'medium recon': {
    size:'medium', type:'recon', preset:'Recon', stealth:'stealth',
    geometry:{length_m:35, width_m:22, height_m:7}, mass:{dry_t:90},
    signatures:{IR:1,EM:1,CS:1},
    performance:{scm_mps:240, vmax_mps:1150, accel_fwd_mps2:58,
      strafe_mps2:{x:60,y:60,z:60}, angular_dps:{pitch:85,yaw:70,roll:105}},
    payload:{cargo_scu:12, crew:'1–2'}, weapons:{summary:'light recon fit'}
  },
  // Capital warships
  'capital corvette': {
    size:'capital', type:'corvette', preset:'Warship', stealth:'standard',
    geometry:{length_m:155, width_m:82, height_m:35}, mass:{dry_t:2000},
    signatures:{IR:4,EM:4,CS:4},
    performance:{scm_mps:140, vmax_mps:850, accel_fwd_mps2:10,
      strafe_mps2:{x:10,y:10,z:15}, angular_dps:{pitch:18,yaw:18,roll:28}},
    payload:{cargo_scu:500, crew:'12–24'}, weapons:{summary:'torpedoes + batteries'}
  },
  'capital frigate': {
    size:'capital', type:'frigate', preset:'Warship', stealth:'standard',
    geometry:{length_m:245, width_m:116, height_m:40}, mass:{dry_t:8000},
    signatures:{IR:4,EM:4,CS:5},
    performance:{scm_mps:110, vmax_mps:800, accel_fwd_mps2:6,
      strafe_mps2:{x:6,y:6,z:10}, angular_dps:{pitch:12,yaw:12,roll:18}},
    payload:{cargo_scu:1200, crew:'30–80'}, weapons:{summary:'6–10 turrets, S10 gun'}
  },
  'capital destroyer': {
    size:'capital', type:'destroyer', preset:'Warship', stealth:'standard',
    geometry:{length_m:345, width_m:148, height_m:65}, mass:{dry_t:16000},
    signatures:{IR:5,EM:5,CS:5},
    performance:{scm_mps:100, vmax_mps:750, accel_fwd_mps2:5,
      strafe_mps2:{x:5,y:5,z:8}, angular_dps:{pitch:10,yaw:10,roll:15}},
    payload:{cargo_scu:3000, crew:'60–200'}, weapons:{summary:'heavy batteries + torpedoes'}
  },
  'capital carrier': {
    size:'capital', type:'carrier', preset:'Warship', stealth:'standard',
    geometry:{length_m:270, width_m:104, height_m:64}, mass:{dry_t:12000},
    signatures:{IR:5,EM:5,CS:5},
    performance:{scm_mps:95, vmax_mps:730, accel_fwd_mps2:5,
      strafe_mps2:{x:5,y:5,z:8}, angular_dps:{pitch:9,yaw:9,roll:14}},
    payload:{cargo_scu:4000, crew:'50–150'}, weapons:{summary:'6–10 turrets, hangars'}
  },
  'capital dreadnought': {
    size:'capital', type:'dreadnought', preset:'Warship', stealth:'standard',
    geometry:{length_m:600, width_m:200, height_m:100}, mass:{dry_t:50000},
    signatures:{IR:5,EM:5,CS:5},
    performance:{scm_mps:80, vmax_mps:700, accel_fwd_mps2:4,
      strafe_mps2:{x:4,y:4,z:6}, angular_dps:{pitch:6,yaw:6,roll:10}},
    payload:{cargo_scu:10000, crew:'200–800'}, weapons:{summary:'capital batteries'}
  }
};

// Compute propulsion fields and RCS budget if missing
export function finalizeNominals(entry){
  const m = entry.mass?.dry_t ?? 0; const a = entry.performance?.accel_fwd_mps2 ?? 0; 
  const main = Number(((m*a)/1000).toFixed(2));
  const tierKey = tier(entry.size);
  const rcs = Number((main * RCS_RATIO[tierKey]).toFixed(2));
  return {
    ...entry,
    propulsion: entry.propulsion || { main_thrust_MN: main, rcs_budget_MN: rcs }
  };
}

export function getNominals(size, type, stealth){
  const key = `${size} ${type}`;
  let base = NOMINALS[key] || null;
  if (!base && stealth && NOMINALS[`${key}`+''] && NOMINALS[`${key}`].stealth==='stealth') base = NOMINALS[`${key}`];
  if (!base && stealth && NOMINALS[`${key}`.replace(type, `stealth ${type}`)]) base = NOMINALS[`${size} stealth ${type}`];
  if (!base && NOMINALS[`${size} stealth ${type}`]) base = NOMINALS[`${size} stealth ${type}`];
  if (!base) return null;
  // Apply inherit/adjust
  if (base.inherit){ const parent = NOMINALS[base.inherit]; base = { ...parent, ...base, geometry:base.geometry||parent.geometry, mass:base.mass||parent.mass, performance:base.performance||parent.performance, signatures:{ IR: Math.max(1,(parent.signatures.IR + (base.adjust?.signatures?.IR||0))), EM: Math.max(1,(parent.signatures.EM + (base.adjust?.signatures?.EM||0))), CS: Math.max(1,(parent.signatures.CS + (base.adjust?.signatures?.CS||0))) } };
  }
  if (stealth && base.stealth==='standard' && (type==='bomber' || type==='dropship')){
    base = JSON.parse(JSON.stringify(base));
    base.stealth = 'stealth';
    base.signatures = { IR: Math.max(1, base.signatures.IR-1), EM: Math.max(1, base.signatures.EM-1), CS: Math.max(1, base.signatures.CS-1) };
  }
  return finalizeNominals(base);
}

// Merge into a ship object; mode: 'fill-empty' or 'overwrite'
export function applyNominals(ship, mode='fill-empty'){
  const n = getNominals(ship.classification.size, ship.classification.type, ship.classification.stealth==='stealth');
  if (!n) return ship;
  const merge = (dst, src) => {
    for (const k of Object.keys(src)){
      if (typeof src[k] === 'object' && src[k] && !Array.isArray(src[k])){
        dst[k] = merge(dst[k]||{}, src[k]);
      } else {
        if (mode==='overwrite' || dst[k]===undefined || dst[k]===null || dst[k]==='' ) dst[k] = src[k];
      }
    }
    return dst;
  };
  const out = JSON.parse(JSON.stringify(ship));
  merge(out, {
    geometry:n.geometry, mass:n.mass, signatures:n.signatures, performance:n.performance,
    propulsion:n.propulsion, payload:n.payload, weapons:n.weapons,
    assist:{ preset:n.preset }
  });
  return out;
}
```

 

### Изменения в editor.html

 

- Импортировать js/nominals.js.
- Добавить кнопку «Применить архетип» рядом с баннером пресета.
- Логика: ship = applyNominals(ship, 'fill-empty'), затем bindFromModel() и render().

 

### Примечания

 

- Номиналы укладываются в наши конверты размеров. При отклонении пользователь увидит предупреждение/ошибку валидатора.
- Для stealth‑вариантов (bomber, dropship) и recon снижаются IR/EM/CS.
- Пресет ассистов подставляется из номинала, но редактируем.

  


