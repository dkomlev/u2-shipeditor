# U2 — План разработки v0.6.3 (для вайб-кодера)

Документ описывает безопасную и последовательную стратегию разработки U2 FlightTest, учитывая, что основной разработчик возвращается к кодингу после долгого перерыва. Цель — разбить работу на независимые, проверяемые шаги и сохранять мотивацию через быстрые win'ы.

## 0. Принципы

- **Только одна переменная за раз.** Любая задача должна завершаться за 1–2 вечера и иметь видимый результат.
- **Контракты первичны.** Сначала фиксируем структуру данных и интерфейсы, затем UI/симуляцию.
- **Автоматическая проверка.** После каждого шага — запуск скрипта/юнит-теста/визуальной проверки.
- **Документирование прогресса.** В конце фазы — короткий лог, что сделано и что осталось.

## 1. Фаза 0 — Подготовка (1–2 дня)

| Цель | Инструменты | Результат |
| --- | --- | --- |
| Развернуть окружение (VS Code + Live Server) | VS Code, Node 18+ | Рабочий `npm run serve` или `python -m http.server` |
| Обновить git-навыки | `git status`, `git commit` | Создана ветка `feature/roadmap-0.6.3` |
| Пройтись по документации 0.6.3 | docs/* | Список непонятных мест и вопросов |

**Критерий готовности:** есть заметка “Что понял / что осталось” и проверен запуск `index.html` в браузере.

## 2. Фаза 1 — Контракты и ресурсы (3–4 дня)

1. **ShipConfig Adapter**
   - Файл: `js/lib/ship-adapter.js`.
   - Функции: `parseShipConfig(json)` → нормализованный `ShipSummary`.
   - Тесты: JSON из `ships/` + миграция 0.5.3.
2. **AppConfig Sections**
   - Файл: `js/lib/appconfig.js`.
   - Функции чтения/валидации для блоков `world`, `physics`, `render`, `input`, `autopilot`.
3. **Manifest Service**
   - Файл: `js/lib/resources.js`.
   - API: `listShips()`, `getShip(path)` с кэшом и graceful fallback.

**Риски:** путаница с путями. Решение — использовать единую функцию `normalizePath`.

## 3. Фаза 2 — Инструменты конфигурации (5–6 дней)

| Подзадача | Зависимости | Проверка |
| --- | --- | --- |
| Обновить AppConfig Editor до использования нового `appconfig.js` | Фаза 1 | Ручной прогон UI + фиксация скриншота |
| Ship Picker с превью (расширить `manifest`) | Фаза 1 | Проверить удаление/добавление файла |
| Лаунчер U2 Test (главная страница) | Picker/Adapter | Проверить случайный выбор корабля |

**Совет:** держать Chrome DevTools открытым, записывать ошибки в отдельный файл `notes/devlog.md`.

## 4. Фаза 3 — Симуляционное ядро (6–8 дней)

1. **Kernel API**
   - Файл: `js/sim/kernel.js`.
   - Функция `step(state, input, env)` без DOM-зависимостей.
2. **Input Controller**
   - Файл: `js/sim/input.js`.
   - Нормализация PC/мобайл-команд, покрытие unit-тестом.
3. **Pilot Assist интеграция**
   - Файл: `js/sim/pilot-assist.js`.
   - Использует данные из `Pilot Assist v0.6.3`.

**Критерий выхода:** возможно запустить “песочницу” (`demo-sim.html`), где корабль как минимум летает вперёд и тормозит в Brake.

## 5. Фаза 4 — Визуализация и HUD (4–5 дней)

- **Renderer** (`js/sim/render.js`): чистая функция `render(ctx, snapshot)`.
- **HUD Overlay** (`js/sim/hud.js`): читает только AppConfig.hud и snapshot.
- **Live Preview Reuse:** AppConfig Editor и Launcher используют тот же renderer в режиме “статического кадра”.

**Риски:** падение FPS. Митигация — добавить счётчик кадров и ограничить число астероидов на превью.

## 6. Фаза 5 — Интеграция и тесты (3–4 дня)

1. **Coordinator** — клеит UI + симуляцию через события.
2. **Smoke Tests** — сценарии: старт, Brake, переключение корабля.
3. **Документация** — обновить `docs/CHANGELOG.md` (создать, если нет).

**Definition of Done:** стенд запускается из браузера, есть инструкция “Как повторить”.

## 7. Поддержка и развитие

- После каждой фазы — `git tag v0.6.3-phaseN`.
- Открывать issue только после того, как завершён текущий шаг (чтобы не распыляться).
- Раз в неделю проводить “рефреш” — пройтись по коду и удалить TODO, чтобы не копился технический долг.
